define("jquery underscore app/utils/utils app/utils/tracking text!app/template/livraison.html app/validator/livraisonValidator app/model/livraisonModel".split(" "),function(e,f,g,h,k,l,m){return function(){this.init=function(){this.el=e("#formulaire-livraison");this.panier=null;this.validator=new l;this.model=new m};this.render=function(c,a){this.panier=c;this.fdp=a;this.model.init(c);f.templateSettings.variable="data";var b=f.template(k);this.el.html(b({sessionFormulaire:this.model.data}));this.renderDedicaceList(this.model.data.dedicaces);
this.makeEvents();this.validator.makeEvents(this);this.model.makeEvents(this);this.el.show();this.el.find(".corps").scrollTop(0)};this.renderDedicaceList=function(c){for(var a in c)e("#dedicaces").append(this.renderDedicace(a,c[a]))};this.renderDedicace=function(c,a){var b=e("\x3cdiv\x3e\x3c/div\x3e");b.addClass("form-item");var d=a.activeDedicace;if(d||null==d)d=!0;b.append(this.renderDedicaceCheck(c,d));b.append(this.renderDedicaceLabel(a.titre));b.append(this.renderDedicaceInput(c,d,a.dedicace));
return b};this.renderDedicaceCheck=function(c,a,b){b=e("\x3cinput/\x3e");b.attr("id","active-dedicace");b.attr("key",c);b.attr("type","checkbox");a&&b.attr("checked","checked");return b};this.renderDedicaceLabel=function(c){var a=e("\x3clabel/\x3e");a.attr("for","dedicace");a.html("D\x26eacute;dicace pour "+c);return a};this.renderDedicaceInput=function(c,a,b){var d=e("\x3cinput/\x3e");d.attr("id","dedicace");d.attr("key",c);d.attr("type","text");0==c?d.attr("placeholder","Laissez vide pour reprendre le prenom de la livraison."):
d.attr("placeholder","Laissez vide pour reprendre le contenu de la premiere dedicace.");a?b&&d.val(b):(d.attr("disabled","true"),d.attr("holder",d.attr("placeholder")),d.attr("placeholder",""));return d};this.makeEvents=function(){var c=this;e("#formulaire-livraison .close").click(function(){c.el.hide()});e(".form-item #active-dedicace").change(function(){var a=e(this).nextAll("input[type\x3dtext]:first");e(this).is(":checked")?(a.removeAttr("disabled"),a.attr("placeholder",a.attr("holder"))):(a.attr("disabled",
"true"),a.attr("holder",a.attr("placeholder")),a.attr("placeholder",""),a.val(""))})};this.submit=function(){h.push("Lancement dun achat");e("#paypal-form #variables").empty();for(var c in this.panier){var a=parseInt(c)+1,b=this.panier[c];this.addToCart(a,b.name,b.price)}this.addVar("shipping_1",this.fdp);this.addVar("address1",this.model.data.adresse);this.addVar("city",this.model.data.ville);this.addVar("email",this.model.data.email);this.addVar("first_name",this.model.data.prenom);this.addVar("last_name",
this.model.data.nom);this.addVar("zip",this.model.data.cp);this.addVar("image_url","http://aeferrets.fr.nf/app/img/favicon.png");this.model.data.commande=this.panier;g.load("achat",this.model.data,function(a){console.log("Mail envoye")});e("#paypal-form").submit()};this.addToCart=function(c,a,b){this.addVar("item_name_"+c,a);this.addVar("amount_"+c,b)};this.addVar=function(c,a){var b=e("\x3cinput /\x3e");b.attr("id",c);b.attr("name",c);b.attr("value",a);b.hide();e("#paypal-form #variables").append(b)};
this.init()}});