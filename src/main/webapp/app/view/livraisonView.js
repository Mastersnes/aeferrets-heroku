define("jquery underscore app/utils/utils app/utils/tracking text!app/template/livraison.html app/validator/livraisonValidator app/model/livraisonModel".split(" "),function(e,f,g,h,k,l,m){return function(){this.init=function(){this.el=e("#formulaire-livraison");this.panier=null;this.validator=new l;this.model=new m};this.render=function(b,a,c){this.panier=b;this.fdp=a;this.nbrLivre=c;this.model.init(b);f.templateSettings.variable="data";b=f.template(k);this.el.html(b({sessionFormulaire:this.model.data}));
this.renderDedicaceList(this.model.data.dedicaces);this.makeEvents();this.validator.makeEvents(this);this.model.makeEvents(this);this.el.show();this.el.find(".corps").scrollTop(0)};this.renderDedicaceList=function(b){e("#dedicaces").empty();for(var a in b)e("#dedicaces").append(this.renderDedicace(a,b[a]))};this.renderDedicace=function(b,a){var c=e("\x3cdiv\x3e\x3c/div\x3e");c.addClass("form-item");var d=a.activeDedicace;if(d||null==d)d=!0;c.append(this.renderDedicaceCheck(b,d));c.append(this.renderDedicaceLabel(a.titre));
c.append(this.renderDedicaceInput(b,d,a.dedicace));return c};this.renderDedicaceCheck=function(b,a,c){c=e("\x3cinput/\x3e");c.attr("id","active-dedicace");c.attr("key",b);c.attr("type","checkbox");a&&c.attr("checked","checked");return c};this.renderDedicaceLabel=function(b){var a=e("\x3clabel/\x3e");a.attr("for","dedicace");a.html("D\x26eacute;dicace pour "+b);return a};this.renderDedicaceInput=function(b,a,c){var d=e("\x3cinput/\x3e");d.attr("id","dedicace");d.attr("key",b);d.attr("type","text");
0==b?d.attr("placeholder","Laissez vide pour reprendre le prenom de la livraison."):d.attr("placeholder","Laissez vide pour reprendre le contenu de la premiere dedicace.");a?c&&d.val(c):(d.attr("disabled","true"),d.attr("holder",d.attr("placeholder")),d.attr("placeholder",""));return d};this.makeEvents=function(){var b=this;e("#formulaire-livraison .close").click(function(){b.el.hide()});e(".form-item #active-dedicace").change(function(){var a=e(this).nextAll("input[type\x3dtext]:first");e(this).is(":checked")?
(a.removeAttr("disabled"),a.attr("placeholder",a.attr("holder"))):(a.attr("disabled","true"),a.attr("holder",a.attr("placeholder")),a.attr("placeholder",""),a.val(""))})};this.submit=function(){h.push("Lancement dun achat");e("#paypal-form #variables").empty();var b=parseInt(this.nbrLivre/2),a;for(a in this.panier){var c=parseInt(a)+1,d=this.panier[a],f=d.price;0<b&&-1<d.name.indexOf("Marque Page")&&(f=0,b--);this.addToCart(c,d.name,f)}this.addVar("shipping_1",this.fdp);this.addVar("address1",this.model.data.adresse);
this.addVar("city",this.model.data.ville);this.addVar("email",this.model.data.email);this.addVar("first_name",this.model.data.prenom);this.addVar("last_name",this.model.data.nom);this.addVar("zip",this.model.data.cp);this.addVar("image_url","http://aeferrets.fr.nf/app/img/favicon.png");this.model.data.commande=this.panier;g.load("achat",this.model.data,function(a){console.log("Mail envoye")});e("#paypal-form").submit()};this.addToCart=function(b,a,c){this.addVar("item_name_"+b,a);this.addVar("amount_"+
b,c)};this.addVar=function(b,a){var c=e("\x3cinput /\x3e");c.attr("id",b);c.attr("name",b);c.attr("value",a);c.hide();e("#paypal-form #variables").append(c)};this.init()}});