define("jquery underscore app/utils/utils app/utils/tracking text!app/template/panier.html app/view/livraisonView jqueryui".split(" "),function(b,h,m,n,k,l){return function(){this.init=function(){this.el=b("#panier-popup");this.listArticle=JSON.parse(sessionStorage.getItem("aeferrets.panier"));this.fdp=0;this.listArticle?b(".panier").show("slow"):this.listArticle=[];this.render()};this.render=function(){h.templateSettings.variable="data";var a=h.template(k);this.el.html(a({}));this.livraison=new l;
this.makeEvents()};this.makeEvents=function(){var a=this;b("#panier").click(function(){a.showArticles()});b("#panier-popup .mask, #panier-popup .close").click(function(){b("#panier-popup").hide()});b("#panier-popup .next").click(function(){a.livraison.render(a.listArticle,a.fdp)})};this.addArticle=function(a,c,d,e){this.listArticle.push({id:(new Date).valueOf(),name:a,price:c,poids:d,needDedicace:e});sessionStorage.setItem("aeferrets.panier",JSON.stringify(this.listArticle));0<b(".panier:visible").length?
b(".panier").effect("shake",{distance:5},"slow"):b(".panier").show("slow")};this.removeArticle=function(a){this.listArticle.splice(a,1);sessionStorage.setItem("aeferrets.panier",JSON.stringify(this.listArticle));this.refreshArticles();0==this.listArticle.length&&(sessionStorage.removeItem("aeferrets.panier"),b(".panier").hide("slow"))};this.showArticles=function(){this.refreshArticles();b("#panier-popup").show()};this.refreshArticles=function(){b(".panier-articles").empty();var a=0,c=0,d=this,e;for(e in this.listArticle){var f=
this.listArticle[e],g=b("\x3cli/\x3e");g.attr("index",e);g.text(f.name+" : "+f.price+" euros");b(".panier-articles").append(g);a=(1E5*a+1E5*parseFloat(f.price))/1E5;c=(1E5*c+1E5*parseFloat(f.poids))/1E5}b(".panier-articles li").click(function(a){a=b(this).attr("index");d.removeArticle(a)});a=a.toFixed(2);c=c.toFixed(2);0<a?(this.fdp=this.calculerFdp(c,a),a="\x3cb\x3eTotal\x3c/b\x3e : "+a+" euros\x3cbr/\x3e",0==this.fdp?a+="Frais de livraison offerts":(a+="+ "+this.fdp+" euros de frais de livraison*\x3cbr/\x3e",
a+="*(offerts \x26agrave; partir de 50 euros d'achat)"),b(".panier-popup-content .total").html(a)):(b("#panier-popup").hide(),b(".panier").hide("slow"))};this.calculerFdp=function(a,b){if(50<=b)return 0;var d=4.8;500<a&&(d=6.2);return d};this.init()}});