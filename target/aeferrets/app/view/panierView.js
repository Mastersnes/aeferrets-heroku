define("jquery underscore app/utils/utils app/utils/tracking text!app/template/panier.html app/view/livraisonView jqueryui".split(" "),function(b,l,p,q,m,n){return function(){this.init=function(){this.el=b("#panier-popup");this.listArticle=JSON.parse(sessionStorage.getItem("aeferrets.panier"));this.nbrLivre=this.fdp=0;this.listArticle?b(".panier").show("slow"):this.listArticle=[];this.render()};this.render=function(){l.templateSettings.variable="data";var a=l.template(m);this.el.html(a({}));this.livraison=
new n;this.makeEvents()};this.makeEvents=function(){var a=this;b("#panier").click(function(){a.showArticles()});b("#panier-popup .mask, #panier-popup .close").click(function(){b("#panier-popup").hide()});b("#panier-popup .next").click(function(){a.livraison.render(a.listArticle,a.fdp,a.nbrLivre)})};this.addArticle=function(a,d,e,c){c&&this.nbrLivre++;this.listArticle.push({id:(new Date).valueOf(),name:a,price:d,poids:e,needDedicace:c});sessionStorage.setItem("aeferrets.panier",JSON.stringify(this.listArticle));
0<b(".panier:visible").length?b(".panier").effect("shake",{distance:5},"slow"):b(".panier").show("slow")};this.removeArticle=function(a){this.listArticle.splice(a,1)[0].needDedicace&&this.nbrLivre--;sessionStorage.setItem("aeferrets.panier",JSON.stringify(this.listArticle));this.refreshArticles();0==this.listArticle.length&&(sessionStorage.removeItem("aeferrets.panier"),b(".panier").hide("slow"))};this.showArticles=function(){this.refreshArticles();b("#panier-popup").show()};this.refreshArticles=
function(){b(".panier-articles").empty();var a=0,d=0,e=this,c=parseInt(this.nbrLivre/2),g;for(g in this.listArticle){var f=this.listArticle[g],h=f.price;0<c&&-1<f.name.indexOf("Marque Page")&&(h=0,c--);var k=b("\x3cli/\x3e");k.attr("index",g);k.text(f.name+" : "+h+" euros");b(".panier-articles").append(k);a=(1E5*a+1E5*parseFloat(h))/1E5;d=(1E5*d+1E5*parseFloat(f.poids))/1E5}b(".panier-articles li").click(function(a){a=b(this).attr("index");e.removeArticle(a)});a=a.toFixed(2);d=d.toFixed(2);0<a?(this.fdp=
this.calculerFdp(d,a),a="\x3cb\x3eTotal\x3c/b\x3e : "+a+" euros\x3cbr/\x3e",0==this.fdp?a+="Frais de livraison offerts":(a+="+ "+this.fdp+" euros de frais de livraison*\x3cbr/\x3e",a+="*(offerts \x26agrave; partir de 50 euros d'achat)"),1==c?a=a+"\x3cbr/\x3e"+("(Vous pouvez choisir "+c+" marque-page gratuit)"):1<c?(a+="\x3cbr/\x3e",a+="(Vous pouvez choisir "+c+" marque-pages gratuits)"):(a+="\x3cbr/\x3e",a+="(1 marque-page gratuit pour 2 livres achet\x26eacute;s)"),b(".panier-popup-content .total").html(a)):
(b("#panier-popup").hide(),b(".panier").hide("slow"))};this.calculerFdp=function(a,b){if(50<=b)return 0;var e=4.8;500<a&&(e=6.2);return e};this.init()}});